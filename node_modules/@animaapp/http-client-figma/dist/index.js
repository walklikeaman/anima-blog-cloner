"use strict";var At=Object.defineProperty,Pt=Object.defineProperties;var Mt=Object.getOwnPropertyDescriptors;var ft=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var pt=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),ht=e=>{throw TypeError(e)};var lt=(e,t,r)=>t in e?At(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b=(e,t)=>{for(var r in t||(t={}))Ot.call(t,r)&&lt(e,r,t[r]);if(ft)for(var r of ft(t))xt.call(t,r)&&lt(e,r,t[r]);return e},G=(e,t)=>Pt(e,Mt(t));var Q=(e,t,r)=>t.has(e)||ht("Cannot "+r);var p=(e,t,r)=>(Q(e,t,"read from private field"),r?r.call(e):t.get(e)),T=(e,t,r)=>t.has(e)?ht("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),m=(e,t,r,s)=>(Q(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),P=(e,t,r)=>(Q(e,t,"access private method"),r);var l=(e,t,r)=>new Promise((s,c)=>{var n=u=>{try{i(r.next(u))}catch(a){c(a)}},o=u=>{try{i(r.throw(u))}catch(a){c(a)}},i=u=>u.done?s(u.value):Promise.resolve(u.value).then(n,o);i((r=r.apply(e,t)).next())});var yt=(e,t,r)=>(t=e[pt("asyncIterator")])?t.call(e):(e=e[pt("iterator")](),t={},r=(s,c)=>(c=e[s])&&(t[s]=n=>new Promise((o,i,u)=>(n=c.call(e,n),u=n.done,Promise.resolve(n.value).then(a=>o({value:a,done:u}),i)))),r("next"),r("return"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var jt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Rt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var J={exports:{}},$t=J.exports,dt;function vt(){return dt||(dt=1,function(e,t){(function(r,s){e.exports=s()})($t,function(){var r=typeof Promise=="function",s=typeof self=="object"?self:jt,c=typeof Symbol!="undefined",n=typeof Map!="undefined",o=typeof Set!="undefined",i=typeof WeakMap!="undefined",u=typeof WeakSet!="undefined",a=typeof DataView!="undefined",f=c&&typeof Symbol.iterator!="undefined",h=c&&typeof Symbol.toStringTag!="undefined",d=o&&typeof Set.prototype.entries=="function",D=n&&typeof Map.prototype.entries=="function",R=d&&Object.getPrototypeOf(new Set().entries()),I=D&&Object.getPrototypeOf(new Map().entries()),A=f&&typeof Array.prototype[Symbol.iterator]=="function",$=A&&Object.getPrototypeOf([][Symbol.iterator]()),C=f&&typeof String.prototype[Symbol.iterator]=="function",q=C&&Object.getPrototypeOf(""[Symbol.iterator]()),X=8,V=-1;function v(y){var ct=typeof y;if(ct!=="object")return ct;if(y===null)return"null";if(y===s)return"global";if(Array.isArray(y)&&(h===!1||!(Symbol.toStringTag in y)))return"Array";if(typeof window=="object"&&window!==null){if(typeof window.location=="object"&&y===window.location)return"Location";if(typeof window.document=="object"&&y===window.document)return"Document";if(typeof window.navigator=="object"){if(typeof window.navigator.mimeTypes=="object"&&y===window.navigator.mimeTypes)return"MimeTypeArray";if(typeof window.navigator.plugins=="object"&&y===window.navigator.plugins)return"PluginArray"}if((typeof window.HTMLElement=="function"||typeof window.HTMLElement=="object")&&y instanceof window.HTMLElement){if(y.tagName==="BLOCKQUOTE")return"HTMLQuoteElement";if(y.tagName==="TD")return"HTMLTableDataCellElement";if(y.tagName==="TH")return"HTMLTableHeaderCellElement"}}var ut=h&&y[Symbol.toStringTag];if(typeof ut=="string")return ut;var E=Object.getPrototypeOf(y);return E===RegExp.prototype?"RegExp":E===Date.prototype?"Date":r&&E===Promise.prototype?"Promise":o&&E===Set.prototype?"Set":n&&E===Map.prototype?"Map":u&&E===WeakSet.prototype?"WeakSet":i&&E===WeakMap.prototype?"WeakMap":a&&E===DataView.prototype?"DataView":n&&E===I?"Map Iterator":o&&E===R?"Set Iterator":A&&E===$?"Array Iterator":C&&E===q?"String Iterator":E===null?"Object":Object.prototype.toString.call(y).slice(X,V)}return v})}(J)),J.exports}var Nt=vt();const Dt=Rt(Nt),it=typeof Buffer!="undefined",It=it&&typeof Buffer.from!="undefined",Ct=it?function(t){return Buffer.isBuffer(t)}:function(){return!1},kt=It?function(t){return Buffer.from(t)}:it?function(t){return new Buffer(t)}:function(t){return t};function B(e){return Ct(e)?"Buffer":Dt(e)}const Bt=new Set(["Arguments","Array","Map","Object","Set"]);function Vt(e,t,r=null){switch(r||B(e)){case"Arguments":case"Array":case"Object":return e[t];case"Map":return e.get(t);case"Set":return t}}function rt(e){return Bt.has(e)}function mt(e,t,r,s=null){switch(s||B(e)){case"Arguments":case"Array":case"Object":e[t]=r;break;case"Map":e.set(t,r);break;case"Set":e.add(r);break}return e}const Ft=typeof globalThis!="undefined"&&globalThis!==null&&globalThis.Object===Object&&globalThis,Ht=typeof global!="undefined"&&global!==null&&global.Object===Object&&global,_t=typeof self!="undefined"&&self!==null&&self.Object===Object&&self,Y=Ft||Ht||_t||Function("return this")();function Lt(e){return e.slice(0)}function Ut(e){return new Boolean(e.valueOf())}function Wt(e){return new DataView(e.buffer)}function qt(e){return kt(e)}function Xt(e){return new Date(e.getTime())}function Gt(e){return new Number(e)}function Jt(e){return new RegExp(e.source,e.flags)}function zt(e){return new String(e)}function O(e,t){return Y[t].from?Y[t].from(e):new Y[t](e)}function g(e){return e}function gt(){return[]}function Kt(){return new Map}function Qt(){return{}}function Yt(){return new Set}const Zt=new Map([["ArrayBuffer",Lt],["Boolean",Ut],["Buffer",qt],["DataView",Wt],["Date",Xt],["Number",Gt],["RegExp",Jt],["String",zt],["Float32Array",O],["Float64Array",O],["Int16Array",O],["Int32Array",O],["Int8Array",O],["Uint16Array",O],["Uint32Array",O],["Uint8Array",O],["Uint8ClampedArray",O],["Array Iterator",g],["Map Iterator",g],["Promise",g],["Set Iterator",g],["String Iterator",g],["function",g],["global",g],["WeakMap",g],["WeakSet",g],["boolean",g],["null",g],["number",g],["string",g],["symbol",g],["undefined",g],["Arguments",gt],["Array",gt],["Map",Kt],["Object",Qt],["Set",Yt]]);function te(){}function st(e,t=null,r=te){arguments.length===2&&typeof t=="function"&&(r=t,t=null);const s=t||B(e),c=Zt.get(s);if(s==="Object"){const n=r(e,s);if(n!==void 0)return n}return c?c(e,s):e}function F(e,t={}){typeof t=="function"&&(t={customizer:t});const{customizer:r}=t,s=B(e);if(!rt(s))return nt(e,null,null,null);const c=st(e,s,r),n=new WeakMap([[e,c]]),o=new WeakSet([e]);return nt(e,c,n,o)}function nt(e,t,r,s,c){const n=B(e),o=st(e,n);if(!rt(n))return o;let i;switch(n){case"Arguments":case"Array":i=Object.keys(e);break;case"Object":i=Object.keys(e),i.push(...Object.getOwnPropertySymbols(e));break;case"Map":case"Set":i=e.keys();break}for(let u of i){const a=Vt(e,u,n);if(s.has(a))mt(t,u,r.get(a),n);else{const f=B(a),h=st(a,f);rt(f)&&(r.set(a,h),s.add(a)),mt(t,u,nt(a,h,r,s),n)}}return t}const ee=e=>new Promise(t=>setTimeout(t,e));var L,N,U,z,Tt;class re{constructor({maxAttempts:t=3,func:r}){T(this,z);T(this,L);T(this,N);T(this,U);m(this,L,t),m(this,U,r),m(this,N,0)}run(){return l(this,null,function*(){try{return yield p(this,U).call(this)}catch(t){if(m(this,N,p(this,N)+1),p(this,N)>p(this,L))throw console.error("Max attempts reached"),t;const r=P(this,z,Tt).call(this);return yield ee(r),yield this.run()}})}}L=new WeakMap,N=new WeakMap,U=new WeakMap,z=new WeakSet,Tt=function(){return p(this,N)*1e3*1.5};function se(){return typeof CompressionStream!="undefined"}function ne(e){return l(this,null,function*(){const r=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),s=[];try{for(var c=yt(r),n,o,i;n=!(o=yield c.next()).done;n=!1){const u=o.value;s.push(u)}}catch(o){i=[o]}finally{try{n&&(o=c.return)&&(yield o.call(c))}finally{if(i)throw i[0]}}return yield oe(s)})}function oe(e){return l(this,null,function*(){const r=yield new Blob(e).arrayBuffer();return new Uint8Array(r)})}class ae extends Error{constructor({resource:t,api:r,args:s,cause:c}){if(super(`API Error on resource "${t}" at api "${r}"`),this.causeProperties={},this.name="API Error",this.resource=t,this.api=r,this.cause=c,this.args=s,c instanceof Error)for(const[o,i]of Object.entries(c))if(typeof Headers!="undefined"&&i instanceof Headers){const u={};i.forEach((a,f)=>{u[f]=a}),this.causeProperties[o]=u}else this.causeProperties[o]=i;const n=this.causeProperties.body;n&&typeof n=="object"&&"code"in n&&(this.code=n.code)}}class wt extends Error{constructor({url:t,method:r,statusCode:s,requestHeaders:c,responseHeaders:n,body:o}){if(super("Fetch Error"),this.name="Fetch Error",this.url=t,this.method=r,this.statusNumber=s,this.requestHeaders=c,this.responseHeaders=n,o)try{const i=JSON.parse(o);this.body=i}catch(i){this.body=o}}}class H extends Error{constructor(t={}){const{canceled:r=!1}=t;super("Abort Error"),this.name="Abort Error",this.canceled=r}}class ie extends Error{constructor(t){super(`Async API Error: ${JSON.stringify(t)}`),this.name="Async API Error",this.body=t}}class Z extends Error{constructor(t){super(t),this.name="Request Validation Error"}}function bt(){return Array.from({length:32},()=>Math.floor(Math.random()*256).toString(16).padStart(2,"0")).join("")}function tt(){return Math.floor(Date.now()/1e3).toString()}const ce=5*60*1e3,ue=1*1e3;var j,w,S,ot,at,_;class fe{constructor({fetch:t=globalThis.fetch.bind(globalThis),baseAddress:r}){T(this,S);T(this,j);T(this,w);this.baseAddress=r,m(this,j,t),m(this,w,{}),this.plugins=[]}get headers(){throw new Error("Missing implementation")}addPlugin(t){this.plugins.push(t)}removePlugin(t){this.plugins=this.plugins.filter(r=>r.name!==t)}withOptions(t={}){return m(this,w,t),this}get(s){return l(this,arguments,function*(t,r={}){const{overrideBaseAddress:c,overrideDefaultHeaders:n}=r,o=c!=null?c:this.baseAddress;let i=n!=null?n:this.headers;const u=F(p(this,w));return m(this,w,{}),u.extraHeaders&&(i=b(b({},i),u.extraHeaders)),u.requestValidation&&(i=G(b({},i),{"X-Request-Nonce":bt(),"X-Request-Timestamp":tt()})),u.async?yield P(this,S,at).call(this,`${o}${t}`,u.async,{headers:i}):yield P(this,S,ot).call(this,`${o}${t}`,u,{headers:i})})}post(c,n){return l(this,arguments,function*(t,r,s={}){const o=F(p(this,w));return m(this,w,{}),P(this,S,_).call(this,t,"POST",r,s,o)})}put(c,n){return l(this,arguments,function*(t,r,s={}){const o=F(p(this,w));return m(this,w,{}),P(this,S,_).call(this,t,"PUT",r,s,o)})}delete(c,n){return l(this,arguments,function*(t,r,s={}){const o=F(p(this,w));return m(this,w,{}),P(this,S,_).call(this,t,"DELETE",r,s,o)})}patch(c,n){return l(this,arguments,function*(t,r,s={}){const o=F(p(this,w));return m(this,w,{}),P(this,S,_).call(this,t,"PATCH",r,s,o)})}}j=new WeakMap,w=new WeakMap,S=new WeakSet,ot=function(t,r,s){return l(this,null,function*(){const c=()=>l(this,null,function*(){var a,f;try{return yield p(this,j).call(this,t,b(b({},s),r.abortSignal&&{signal:r.abortSignal}))}catch(h){throw h instanceof Error&&h.name==="AbortError"?new H({canceled:(f=(a=r.abortSignal)==null?void 0:a.aborted)!=null?f:!1}):h}}),{headers:n}=s!=null?s:{},o=(a,f)=>{var h,d;return((h=a==null?void 0:a.headers)==null?void 0:h.get(f))||((d=a==null?void 0:a.headersObject)==null?void 0:d[f])||""},i=a=>l(this,null,function*(){var h;if(!a.ok){const d=yield a.text().catch();throw new wt({url:t,method:(h=s==null?void 0:s.method)!=null?h:"GET",statusCode:a.status,requestHeaders:n,responseHeaders:a.headers,body:d})}if(r.requestValidation&&process.env.UI_TESTS!==!0)try{const d=o(a,"x-response-nonce"),D=n==null?void 0:n["X-Request-Nonce"];if(!d||d!==D)throw new Z("Response nonce mismatch");const R=Number(o(a,"x-response-timestamp")),I=Number(tt()),A=60*60*24;if(isNaN(R)||Math.abs(I-R)>A)throw new Z("Invalid response timestamp")}catch(d){const D=d instanceof Error?d.message:"Request validation failed";throw new Z(D)}let f=yield a.text();try{f=JSON.parse(f)}catch(d){}return f});if(r.retry){const f=yield new re({maxAttempts:r.retry,func:c}).run();return yield i(f)}const u=yield c();return yield i(u)})},at=function(t,r,s){return l(this,null,function*(){var R,I;const{onProgress:c,abortSignal:n,pollingInterval:o=()=>ue,maxTimeout:i=ce}=r,u=`${t}/async`,a=`${t}/async/job`;let f;try{f=yield p(this,j).call(this,u,b(b({},s),n&&{signal:n}))}catch(A){throw A instanceof Error&&A.name==="AbortError"?new H({canceled:(R=n==null?void 0:n.aborted)!=null?R:!1}):A}if(!f.ok){const A=yield f.text().catch();throw new wt({url:t,method:(I=s==null?void 0:s.method)!=null?I:"GET",statusCode:f.status,requestHeaders:this.headers,responseHeaders:f.headers,body:A})}const h=yield f.json(),{job_id:d}=h;if(!d)throw new Error("Job ID not found in response");return new Promise((A,$)=>l(this,null,function*(){const C=setTimeout(()=>{$(new Error("Job timed out"))},i),q=(X=0)=>l(this,null,function*(){if(n!=null&&n.aborted){clearTimeout(C),p(this,j).call(this,`${a}/${d}/cancel`,{method:"POST",headers:this.headers}).then(()=>{$(new H({canceled:!0}))}).catch(V=>{$(new H({canceled:!1}))});return}try{const v=yield(yield p(this,j).call(this,`${a}/${d}`,{headers:this.headers})).json();if(v.status==="success"){clearTimeout(C);const y=v.response_json;A(y)}else if(v.status==="failed")clearTimeout(C),$(new ie(v.response_json));else{c&&c(v.response_json);const y=o(X);setTimeout(()=>q(X+1),y)}}catch(V){$(V)}});q()}))})},_=function(t,r,s,c,n){return l(this,null,function*(){const{overrideBaseAddress:o,overrideDefaultHeaders:i}=c,u=o!=null?o:this.baseAddress;let a=i!=null?i:this.headers;n.extraHeaders&&(a=b(b({},a),n.extraHeaders)),n.requestValidation&&(a=G(b({},a),{"X-Request-Nonce":bt(),"X-Request-Timestamp":tt()}));let f=s;return typeof FormData!="undefined"&&s instanceof FormData?delete a["Content-Type"]:(f=c.skipBodyJsonStringify?s:JSON.stringify(s),n.compress&&se()&&(a["Content-Encoding"]="gzip",f=yield ne(f))),n.async?yield P(this,S,at).call(this,`${u}${t}`,n.async,{method:r,headers:a,body:f}):yield P(this,S,ot).call(this,`${u}${t}`,n,{method:r,headers:a,body:f})})};const Et=(e,t,r,s)=>e instanceof H?e:new ae({resource:t,api:String(r),args:s,cause:e}),et=(e,t)=>new Proxy(t,{get(r,s){return(...c)=>{var o;for(const i of e.plugins){const u=(o=i.beforeApi)==null?void 0:o.call(i,{resource:r.resourceName,api:s,args:c});if(u!==void 0)return u}let n;try{n=r[s](...c)}catch(i){throw Et(i,r.resourceName,s,c)}return n instanceof Promise?n.catch(i=>{throw Et(i,r.resourceName,s,c)}):n}}});var k;class pe{constructor(t){T(this,k);this.resourceName="Files",m(this,k,t)}get(s){return l(this,arguments,function*({fileKey:t,params:r={}}){const c=new URLSearchParams(b({plugin_data:"857346721138427857"},r)).toString(),n=`v1/files/${t}?${c}`;return yield p(this,k).get(n)})}getImageFills(r){return l(this,arguments,function*({fileKey:t}){var n,o;const s=`v1/files/${t}/images`;return(o=(n=(yield p(this,k).get(s)).meta)==null?void 0:n.images)!=null?o:{}})}}k=new WeakMap;const le=(e,t,r)=>{const s=t.sort();return`${e}-${s.join("-")}-${r}`},he=e=>e?e.ts>Date.now()-1e3*30:!1;var M,K,St;class ye{constructor(t){T(this,K);T(this,M);this.resourceName="Images",m(this,M,t)}get(n){return l(this,arguments,function*({fileKey:t,nodeIds:r,format:s="jpg",scale:c}){const o=le(t,r,s),i=p(this,M).cache.images.entries.get(o);if(he(i))return i.result;i&&p(this,M).cache.images.entries.delete(o);const a=p(this,M).cache.images.pendingRequests.get(o);if(a)return a;const f=P(this,K,St).call(this,o,t,r,s,c);p(this,M).cache.images.pendingRequests.set(o,f);try{return yield f}finally{p(this,M).cache.images.pendingRequests.delete(o)}})}}M=new WeakMap,K=new WeakSet,St=function(t,r,s,c,n){return l(this,null,function*(){const o=yield p(this,M).get(`v1/images/${r}?ids=${s}&format=${c}${n?`&scale=${n}`:""}`);return p(this,M).cache.images.entries.set(t,{result:o,ts:Date.now()}),o})};var W;class de{constructor(t){T(this,W);this.resourceName="Nodes",m(this,W,t)}get(c){return l(this,arguments,function*({fileKey:t,nodeIds:r,params:s={}}){const n=G(b({},s),{ids:r.join(",")}),o=new URLSearchParams(b({plugin_data:"857346721138427857"},n)).toString(),i=`v1/files/${t}/nodes?${o}`;return yield p(this,W).get(i)})}}W=new WeakMap;var x;class me extends fe{constructor({baseAddress:r="https://api.figma.com/",fetch:s=globalThis.fetch.bind(globalThis)}={}){super({fetch:s,baseAddress:r});T(this,x,"");this.cache={images:{entries:new Map,pendingRequests:new Map}},this.files=et(this,new pe(this)),this.nodes=et(this,new de(this)),this.images=et(this,new ye(this))}set token(r){if(!r.startsWith("figd_")&&!r.startsWith("figu_"))throw new Error("Invalid Figma access token");m(this,x,r)}get token(){return p(this,x)}get headers(){const r={"Content-Type":"application/json"};return p(this,x).startsWith("figd_")?r["X-FIGMA-TOKEN"]=p(this,x):p(this,x).startsWith("figu_")&&(r.Authorization=`Bearer ${p(this,x)}`),r}}x=new WeakMap;exports.FigmaRestApi=me;
